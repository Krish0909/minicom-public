<!DOCTYPE html>
<html>
<head>
    <title>Agent Dashboard - Minicom</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 900px; margin: 30px auto; padding: 20px; }
        h2 { color: #333; }
        .conversation-list { border: 1px solid #ddd; border-radius: 5px; }
        .conversation-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.2s;
        }
        .conversation-item:hover { background: #f5f5f5; }
        .conversation-item:last-child { border-bottom: none; }
        .customer-id { font-weight: bold; color: #007bff; font-size: 18px; }
        .meta { color: #666; font-size: 14px; margin-top: 5px; }
        .bot-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
        }
        .bot-active { background: #fff3cd; color: #856404; }
        .human-active { background: #d4edda; color: #155724; }
        .empty-state { text-align: center; padding: 40px; color: #999; }
    </style>
</head>
<body>
    <h2>üéß Agent Dashboard</h2>
    <p>Click on a conversation to join and assist the customer</p>

    <div id="conversation-list" class="conversation-list">
        <div class="empty-state">Loading conversations...</div>
    </div>

    <script>
        // Load all conversations from API
        function loadConversations() {
            fetch('/api/agent/dashboard/')
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('conversation-list');

                    if (data.conversations.length === 0) {
                        container.innerHTML = '<div class="empty-state">No conversations yet. Waiting for customers...</div>';
                        return;
                    }

                    container.innerHTML = '';

                    data.conversations.forEach(conv => {
                        const item = document.createElement('div');
                        item.className = 'conversation-item';
                        item.onclick = () => {
                            // Navigate to agent chat interface for this customer
                            window.location.href = `/agent/chat/${conv.customer_id}/`;
                        };

                        const statusBadge = conv.is_bot_active
                            ? '<span class="bot-badge bot-active">ü§ñ BOT</span>'
                            : '<span class="bot-badge human-active">üë§ HUMAN</span>';

                        item.innerHTML = `
                            <div class="customer-id">Customer: ${conv.customer_id} ${statusBadge}</div>
                            <div class="meta">
                                üí¨ ${conv.message_count} messages |
                                üïê Started: ${new Date(conv.created_at).toLocaleString()}
                            </div>
                        `;

                        container.appendChild(item);
                    });
                });
        }

        // Load conversations on page load
        loadConversations();

        // Refresh every 5 seconds to show new conversations
        setInterval(loadConversations, 5000);
    </script>
</body>
</html>
